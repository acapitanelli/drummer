#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from drummer.utils import ClassLoader
from sys import exit as sys_exit
from sys import argv as sys_argv
import argparse

if len(sys_argv)==1:
    print('Command missing. See -h for usage.')
    sys_exit()

# create the top-level parser
parser = argparse.ArgumentParser(prog='Drummer Admin')
# add subparsers
subparsers = parser.add_subparsers(help='command help', title='Admin commands', description='Drummer Management')

# init
parser_00 = subparsers.add_parser('init', help='Init Drummer environment')
parser_00.add_argument('root_dir', action='store', help='Root folder for Drummer environment')
parser_00.add_argument(
'--database',
dest='database',
const='drummer.sqlite',
default='drummer.sqlite',
action='store',
nargs='?',
type=str,
help='Filename for internal schedulation database'
)
parser_00.set_defaults(classname='EnvInit')

args = vars(parser.parse_args(sys_argv[1:]))

classname = args.get('classname')
del args['classname']

# load command
Command = ClassLoader().load('drummer/console/commands', classname)

# execute command
Command().execute(args)
